#/bin/sh
COUNTER=1
echo "Import is waiting for database startup ..."
until [ $COUNTER -gt 500 ]
do
        READY=`pg_isready -h localhost -U postgres | grep -c  'Verbindungen werden angenommen'`
    if [ $READY -gt 0 ]
    then
       echo "Database is online." 

       DATE=`date`
       echo start import-calendar: $DATE
       java -jar  $APP_DIR/iot2Batch.jar -c import-calendar ${APP_DIR}/calendar.csv
       
       DATE=`date`
       echo start import-configuration: $DATE
       java -jar  $APP_DIR/iot2Batch.jar -c import-configuration ${APP_DIR}/configuration.csv
       
       DATE=`date`
       echo start create-user: $DATE
       java -jar  $APP_DIR/iot2Batch.jar -c update-user mquasten manfred01 MD5
       
       rm  /tmp/spring.log 
       exit 0;
    fi;
    sleep 2;
    COUNTER=$((COUNTER + 1));
done

echo "Timeout: database not started. Nothing imported!"
exit 1;